{"code":"// Das ist die Spiel Logik\r\nimport { PIXELSIZE, COLORS, HEIGHT, MAX_LEVEL, SCALE, SPEED, WIDTH, Direction } from \"./constants\";\r\nimport { Playground as Playground } from \"./playground\";\r\nimport { Snake } from \"./snake\";\r\nexport class Game {\r\n    constructor() {\r\n        this.score = 0;\r\n        this.controlFunction = false;\r\n        this.nextMove = 0;\r\n        // Div angelegt\r\n        this.div = document.createElement(\"div\");\r\n        this.div.setAttribute(\"id\", \"playground\");\r\n        // Canvas angelegt\r\n        this.canvas = document.createElement(\"Canvas\");\r\n        this.div.appendChild(this.canvas);\r\n        // ls: Exit Button angelegt\r\n        this.buttonExit = document.createElement(\"button\");\r\n        this.buttonExit.onclick = this.exit.bind(this);\r\n        this.buttonExit.innerText = \"Exit\";\r\n        this.buttonExit.setAttribute(\"class\", \"exitdesign\");\r\n        this.div.appendChild(this.buttonExit);\r\n        // Größe des Canvas-Elements auf der Seite\r\n        this.canvas.style.width = WIDTH * PIXELSIZE + 'px';\r\n        this.canvas.style.height = HEIGHT * PIXELSIZE + 'px';\r\n        // Bildpuffergröße\r\n        this.canvas.width = WIDTH * PIXELSIZE * SCALE;\r\n        this.canvas.height = HEIGHT * PIXELSIZE * SCALE;\r\n        // Konfiguration\r\n        this.setting = {\r\n            level: 0,\r\n            speed: SPEED,\r\n            width: this.canvas.width,\r\n            height: this.canvas.height,\r\n            nbPixelX: WIDTH,\r\n            nbPixelY: HEIGHT,\r\n            pixelWidth: this.canvas.width / WIDTH,\r\n            pixelHeight: this.canvas.height / HEIGHT,\r\n            color: COLORS[0]\r\n        };\r\n        this.snake = new Snake(this);\r\n        this.playground = new Playground(this, false);\r\n        // sobald eine Pfeiltaste gedrückt wird die onKeyDown Funktion aufgerufen\r\n        window.addEventListener(\"keydown\", this.onKeyDown.bind(this), false);\r\n        document.body.appendChild(this.div);\r\n    }\r\n    // Spiel starten\r\n    start() {\r\n        this.nextMove = 0;\r\n        this.controlFunction = true;\r\n        requestAnimationFrame(this.loop.bind(this));\r\n    }\r\n    // Spiel stoppen\r\n    stop() {\r\n        this.controlFunction = false;\r\n    }\r\n    // ls: Stoppt das Spiel mit dem Button Exit\r\n    exit() {\r\n        this.stop();\r\n        this.div.remove();\r\n        const wrapper = document.getElementById(\"wrapper\");\r\n        // ls: zuvor versteckter wrapper soll wieder erscheinen um erneut eine Auswahl zu treffen\r\n        if (wrapper != null) {\r\n            wrapper.style.display = \"block\";\r\n        }\r\n    }\r\n    getSettings() {\r\n        return this.setting;\r\n    }\r\n    loop(time) {\r\n        // stopp falls controlFunction gleich false\r\n        if (this.controlFunction) {\r\n            // rekursion (Funktion ruft sich immer wieder selbst auf)\r\n            requestAnimationFrame(this.loop.bind(this));\r\n            // prüfe ob es Zeit für den nächsten Schlangenschritt ist\r\n            if (time >= this.nextMove) {\r\n                // Zeitpunkt für den nächsten Spielzug setzten\r\n                this.nextMove = time + this.setting.speed;\r\n                // Schlange einmal bewegen\r\n                this.snake.move();\r\n                // prüfe ob Spiel zu ende / level up / oder normal weiter \r\n                switch (this.checkCondition()) {\r\n                    case -1:\r\n                        this.die();\r\n                        break;\r\n                    case 1:\r\n                        this.snake.lengthen();\r\n                        this.score += 100;\r\n                        this.playground.eatKiwi(this.snake.getSnakeHead());\r\n                        if (this.playground.isDone()) {\r\n                            this.levelUp();\r\n                        }\r\n                    default:\r\n                        // update display\r\n                        const { width, height, color, level } = this.setting;\r\n                        const context = this.canvas.getContext(\"2d\");\r\n                        this.displayBackground(context, color, width, height);\r\n                        this.displayLevel(context, width, height, level);\r\n                        this.displayScore(context);\r\n                        this.displayPlayground(context);\r\n                        this.displaySnake(context);\r\n                }\r\n            }\r\n        }\r\n    }\r\n    displayBackground(context, color, width, height) {\r\n        // Hintergrundfarbe\r\n        context.fillStyle = color;\r\n        context.fillRect(0, 0, width, height);\r\n    }\r\n    displayLevel(context, width, height, level) {\r\n        // Level\r\n        context.font = height + \"px Roboto Condensed\";\r\n        context.textBaseline = \"middle\";\r\n        context.textAlign = \"center\";\r\n        context.fillStyle = \"rgba(0,0,0,0.1)\";\r\n        context.fillText(String(level + 1), width / 2, height / 2);\r\n    }\r\n    displayScore(context) {\r\n        // Punkzahl\r\n        context.font = 35 * SCALE + \"px Roboto Condensed\";\r\n        context.textAlign = \"left\";\r\n        context.textBaseline = \"top\";\r\n        context.fillStyle = \"rgba(0,0,0,0.25)\";\r\n        context.fillText(String(this.score), 10 * SCALE, 10 * SCALE);\r\n    }\r\n    displayPlayground(context) {\r\n        // Spielfeld\r\n        this.playground.draw(context);\r\n    }\r\n    displaySnake(context) {\r\n        // Schlange neu gezeichnet\r\n        this.snake.draw(context);\r\n    }\r\n    checkCondition() {\r\n        // Position des Kopfes der Schlange\r\n        const cell = this.snake.getSnakeHead();\r\n        // ls: ist die Schlange aus dem Spielfeld oder hat sie sich selbst gefressen?\r\n        if (this.checkDead(cell)) {\r\n            return -1;\r\n        }\r\n        // ls: hat die Schlange eine Kiwi gegessen?\r\n        if (this.ateKiwi(cell)) {\r\n            return 1;\r\n        }\r\n        // nichts Besonderes\r\n        return 0;\r\n    }\r\n    // ls: Den Spielbereich verlassen oder sich selbst gefressen?\r\n    checkDead(cell) {\r\n        if (this.isOutside(cell) || this.snake.isSnake(cell)) {\r\n            // Tod\r\n            return true;\r\n        }\r\n    }\r\n    // ls: eine Kiwi gegessen?\r\n    ateKiwi(cell) {\r\n        if (this.playground.isKiwi(cell)) {\r\n            return true;\r\n        }\r\n    }\r\n    // alle Kiwis der Runde sind gegessen --> Level Up\r\n    levelUp() {\r\n        this.score += 1000;\r\n        this.setting.level++;\r\n        if (this.setting.level < MAX_LEVEL) {\r\n            this.setting.speed -= 7; //Spiel verschnellern\r\n            this.setting.color = COLORS[this.setting.level]; //Hintergrundfarbe ändern\r\n            this.playground.scatter(); //Kiwis verstreuen\r\n        }\r\n        else {\r\n            this.win();\r\n        }\r\n    }\r\n    win() {\r\n        alert(\"Congrats you beat Linda´s Snake Game!\\r\\n\\r\\nFinal Score: \" + this.score);\r\n        this.stop();\r\n    }\r\n    die() {\r\n        alert(\"You died.\\r\\n\\r\\nFinal Score: \" + this.score);\r\n        this.stop();\r\n    }\r\n    // Prüfe ob sich der Kopf der Schlange außerhalb des Canvas befindet\r\n    isOutside(pixel) {\r\n        const { nbPixelX: nbCellsX, nbPixelY: nbCellsY } = this.setting;\r\n        // links aus dem Spiel raus / rechts aus dem Spiel raus / oben aus dem Spiel Raus / unten aus dem Spiel raus\r\n        return pixel.x < 0 || pixel.x >= nbCellsX || pixel.y < 0 || pixel.y >= nbCellsY;\r\n    }\r\n    // ls: Prüfe welche Pfeiltaste gedrückt wurde (enum ergänzt)\r\n    onKeyDown(event) {\r\n        switch (event.key) {\r\n            case \"ArrowUp\":\r\n                event.preventDefault();\r\n                this.snake.setDirection(Direction.UP);\r\n                break;\r\n            case \"ArrowDown\":\r\n                event.preventDefault();\r\n                this.snake.setDirection(Direction.DOWN);\r\n                break;\r\n            case \"ArrowLeft\":\r\n                event.preventDefault();\r\n                this.snake.setDirection(Direction.LEFT);\r\n                break;\r\n            case \"ArrowRight\":\r\n                event.preventDefault();\r\n                this.snake.setDirection(Direction.RIGHT);\r\n                break;\r\n        }\r\n    }\r\n}\r\n","references":["C:/Users/Linda/OneDrive/Desktop/snake-game/src/constants.ts","C:/Users/Linda/OneDrive/Desktop/snake-game/src/playground.ts","C:/Users/Linda/OneDrive/Desktop/snake-game/src/snake.ts"]}

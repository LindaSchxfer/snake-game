{"code":"//this is the main locic\r\nimport { PIXELSIZE, COLORS, HEIGHT, MAX_LEVEL, SCALE, SPEED, WIDTH } from \"./constants\";\r\nimport { Playground as Playground } from \"./playground\";\r\nimport { Snake } from \"./snake\";\r\nexport class Game {\r\n    constructor() {\r\n        this.score = 0;\r\n        this.controlFunction = false;\r\n        this.nextMove = 0;\r\n        this.canvas = document.createElement('Canvas');\r\n        document.body.appendChild(this.canvas);\r\n        // canvas element size in the page\r\n        this.canvas.style.width = WIDTH * PIXELSIZE + 'px';\r\n        this.canvas.style.height = HEIGHT * PIXELSIZE + 'px';\r\n        // image buffer size \r\n        this.canvas.width = WIDTH * PIXELSIZE * SCALE;\r\n        this.canvas.height = HEIGHT * PIXELSIZE * SCALE;\r\n        // configuration\r\n        this.setting = {\r\n            level: 0,\r\n            speed: SPEED,\r\n            width: this.canvas.width,\r\n            height: this.canvas.height,\r\n            nbPixelX: WIDTH,\r\n            nbPixelY: HEIGHT,\r\n            pixelWidth: this.canvas.width / WIDTH,\r\n            pixelHeight: this.canvas.height / HEIGHT,\r\n            color: COLORS[0]\r\n        };\r\n        this.snake = new Snake(this);\r\n        this.playground = new Playground(this);\r\n        // event listeners\r\n        window.addEventListener('keydown', this.onKeyDown.bind(this), false);\r\n        this.canvas.addEventListener('touchstart', this.onTouchStart.bind(this), false);\r\n        this.canvas.addEventListener('touchmove', this.onTouchMove.bind(this), false);\r\n        this.canvas.addEventListener('touchend', this.onTouchEnd.bind(this), false);\r\n    }\r\n    start() {\r\n        this.nextMove = 0;\r\n        this.controlFunction = true;\r\n        requestAnimationFrame(this.loop.bind(this));\r\n    }\r\n    stop() {\r\n        this.controlFunction = false;\r\n    }\r\n    getSettings() {\r\n        return this.setting;\r\n    }\r\n    loop(time) {\r\n        if (this.controlFunction) {\r\n            requestAnimationFrame(this.loop.bind(this));\r\n            if (time >= this.nextMove) {\r\n                this.nextMove = time + this.setting.speed;\r\n                // move once\r\n                this.snake.move();\r\n                // check what happened  \r\n                switch (this.checkCondition()) {\r\n                    case -1:\r\n                        this.die();\r\n                        break;\r\n                    case 1:\r\n                        this.snake.lengthen();\r\n                        this.score += 100;\r\n                        this.playground.eatKiwi(this.snake.getSnakeHead());\r\n                        if (this.playground.isDone()) {\r\n                            this.levelUp();\r\n                        }\r\n                    default:\r\n                        // update display\r\n                        this.display(time);\r\n                }\r\n            }\r\n        }\r\n    }\r\n    display(time) {\r\n        const { width, height, color, level } = this.setting;\r\n        const context = this.canvas.getContext(\"2d\");\r\n        // background\r\n        context.fillStyle = color;\r\n        context.fillRect(0, 0, width, height);\r\n        // level\r\n        context.font = height + 'px Roboto Condensed';\r\n        context.textBaseline = 'middle';\r\n        context.textAlign = 'center';\r\n        context.fillStyle = 'rgba(0,0,0,0.1)';\r\n        context.fillText(level + 1, width / 2, height / 2);\r\n        // score\r\n        context.font = 35 * SCALE + 'px Roboto Condensed';\r\n        context.textAlign = 'left';\r\n        context.textBaseline = 'top';\r\n        context.fillStyle = 'rgba(0,0,0,0.25)';\r\n        context.fillText(this.score, 10 * SCALE, 10 * SCALE);\r\n        // playground\r\n        this.playground.draw(time, context);\r\n        // snake\r\n        this.snake.draw(time, context);\r\n    }\r\n    checkCondition() {\r\n        const cell = this.snake.getSnakeHead();\r\n        // left the play area or ate itself?? \r\n        if (this.isOutside(cell) || this.snake.isSnake(cell)) {\r\n            // dead\r\n            return -1;\r\n        }\r\n        // ate kiwi?\r\n        if (this.playground.isKiwi(cell)) {\r\n            return 1;\r\n        }\r\n        // nothing special\r\n        return 0;\r\n    }\r\n    levelUp() {\r\n        this.score += 1000;\r\n        this.setting.level++;\r\n        if (this.setting.level < MAX_LEVEL) {\r\n            this.setting.speed -= 7;\r\n            this.setting.color = COLORS[this.setting.level];\r\n            this.playground.scatter();\r\n        }\r\n        else {\r\n            this.win();\r\n        }\r\n    }\r\n    win() {\r\n        alert(\"Congrats you beat the game!\\r\\n\\r\\nFinal Score: \" + this.score);\r\n        this.stop();\r\n    }\r\n    die() {\r\n        alert(\"You died.\\r\\n\\r\\nFinal Score: \" + this.score);\r\n        this.stop();\r\n    }\r\n    isOutside(pixel) {\r\n        const { nbPixelX: nbCellsX, nbPixelY: nbCellsY } = this.setting;\r\n        return pixel.x < 0 || pixel.x >= nbCellsX || pixel.y < 0 || pixel.y >= nbCellsY;\r\n    }\r\n    onKeyDown(event) {\r\n        switch (event.key) {\r\n            case 'ArrowUp':\r\n                event.preventDefault();\r\n                this.snake.setDirection('Up');\r\n                break;\r\n            case 'ArrowDown':\r\n                event.preventDefault();\r\n                this.snake.setDirection('Down');\r\n                break;\r\n            case 'ArrowLeft':\r\n                event.preventDefault();\r\n                this.snake.setDirection('Left');\r\n                break;\r\n            case 'ArrowRight':\r\n                event.preventDefault();\r\n                this.snake.setDirection('Right');\r\n                break;\r\n        }\r\n    }\r\n    onTouchStart(e) {\r\n        this.touch = e.changedTouches[0];\r\n        e.preventDefault();\r\n    }\r\n    onTouchMove(e) {\r\n        e.preventDefault();\r\n    }\r\n    onTouchEnd(e) {\r\n        const touch = e.changedTouches[0];\r\n        const distX = touch.pageX - this.touch.pageX;\r\n        const distY = touch.pageY - this.touch.pageY;\r\n        let direction = null;\r\n        if (Math.abs(distX) >= 100) {\r\n            direction = (distX < 0) ? 'Left' : 'Right';\r\n        }\r\n        else if (Math.abs(distY) >= 100) {\r\n            direction = (distY < 0) ? 'Up' : 'Down';\r\n        }\r\n        if (direction) {\r\n            this.snake.setDirection(direction);\r\n        }\r\n        e.preventDefault();\r\n    }\r\n}\r\n","references":["C:/Users/Linda/OneDrive/Desktop/snake-game/src/pixel.ts","C:/Users/Linda/OneDrive/Desktop/snake-game/src/constants.ts","C:/Users/Linda/OneDrive/Desktop/snake-game/src/playground.ts","C:/Users/Linda/OneDrive/Desktop/snake-game/src/snake.ts"]}
